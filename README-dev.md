# README

This README is for internal use and a reference for any developer. 

**Roadmap**

* [ ] StructureView: nested variables
* [ ] SmartElements: visibility

## Parser

The parser is the most important element as the parsed tree is used as the base of every feature. As the parser is still very unstable, elements are integrated one by one. 

The plugin is based on a [parser generated by grammar kit](https://github.com/JetBrains/Grammar-Kit). The parser rules are, as much as possible, similar to the one [in the official documentation]( https://v2.ocaml.org/manual/lex.html).

* `OCaml.bnf`: the parser rules for ML and MLI (ML by default, uncomment out the two lines for MLI)
* `_OCamlLexer.flex`: to generate the symbols used by the parser

**Roadmap**

* Add some pins for parser recovery
  * [x] A few example pins were added
  * [ ] Add more pins
  * [ ] Verify/test pins
* [x] Currently parser errors are hidden using highlightErrorFilter ‚úçÔ∏è
* [ ] Make it simple to compile both parsers
* [ ] Ensure parser works on 0Caml 4.14 Code
* [ ] Ensure parser works on 0Caml 4.13 Code
* [ ] Ensure parser works on 0Caml 4.12 Code
* [ ] Ensure parser works on 0Caml 4.11 Code
* [ ] Ensure parser works on 0Caml 4.10 Code

üìö Some tests are required for each parser element.

* `exception Undefined = CamlinternalLazy.Undefined`
* ...

## Creating A New Project

The following features were implemented in IntelliJ:

* [x] We can create a project (folder name, git, etc.)
* [x] Working in both the new and the old UI
* [x] Can use a template
  * [x] Dune template
  * [x] Makefile template
  * [x] IntelliJ template
* [x] Can set the project SDK
  * [ ] Can add an SDK from an arbitrary path (Removed Code)
  * * [ ] Can create a "SimpleSDK" (non-opam) (Removed Code)

Once created, we can use the project structure to edit the module configuration (SDK, SRC/OUT folders, etc.).

üìö We can also create new modules the same way as for projects.

## Building/Running the project

We can only run dune executables for now:

* [x] Run icon shown next to the executables name
* [x] Verify the configuration
* [x] Build in the module output folder
* [x] Trigger "dune exec" on Run
* [ ] Support "executables"+"names"
* [ ] Use variables (e.g. Project dir, etc.)
* [ ] Autocompletion of the target
* [ ] Limit the values of target (select?)

We would want:

* [ ] Build dune libraries
* [ ] Work on the "build" dependency
* [ ] Test if "makefile" works
* [ ] Implement "IntelliJ" Build&Run

There is something important to note. Currently, the "build" itself is not handled at all. When we run "dune exec", it triggers "build" which moves files in the output folder and does nothing. It eventually works because "dune exec" is first compiling files, but when doing so, it is ALSO copying files in the output folder but in another subfolder, which is not optimal at all.

## Creating New Files

Aside from a new action to create a ".ml", a ".mli", or both, there is nothing worth mentioning.

## File Highlight

Files matching `*.ml`/`*.mli` are highlighted and the following are annotated (in short, it means they are not considered as text and can be used with smart features):

* [x] Variables (LET/VAL)
* [x] Functions (LET/VAL)
* [x] Types (TYPE)
* [ ] Every other element

Similarly to JAVA, you can change highlight colors in settings:

* [X] Color Settings Page For Highlighter
* [x] Add Highlighter Annotator to Color Settings Page

üìö Dune files are highlighted and annotated too. They also have their colors settings page.

## Live Templates

A live template is a code sample that is generated when selected in a specified context. For instance, inside a method in JAVA (context), when we write "for" and select the live template "fori" to generate a "for i loop".

For now, we have the following contexts:

* [x] OCaml file (interface or not)
  * [x] This scope exclude comments
* [ ] Refine the scopes...

And a few templates in `liveTemplates/default.xml`.

‚úçÔ∏è There are no live templates for Dune.

üìö Both OCaml and Dune have Braces matching (hover the other).

## Documentation

For annotated elements, you can use `CTRL+Q`/`<hover>` to view their quick documentation. 

* [x] ...

For normal comments:

* [x] Single Line Comments Handler (CTRL+/)
* [x] Multi Lines Comments Handler (CTRL+SHIFT+/)
* [ ] Comments: space not removed after uncommenting ("(* ")

## Spellchecking

Comments, documentation, strings, and identifiers (annotated elements as identifiers) have spellchecking.

## Structure View

The Structure View can be opened with `ALT+7` for OCaml files. It only shows annotated elements.

* [x] Show the name of the element
* [x] Show the type of the element as an ICON
* [x] Show the visibility of the element as an ICON
* [ ] Show nested annotated elements
* [ ] Show function arguments?

The structure view panel itself can have more features:

* [ ] Filters (nested variables?)

A few tests were implemented:

* [x] One/Multiple variable
* [x] Redefinitions
* [x] Deconstructions (Let)
* [x] Anonymous (Let)
* [x] And (Let, Type)

üìö Dune also has a working structure view.

* [ ] Test it
* [ ] Do not show empty lists
* [ ] Do not show values (strings, atoms)

## OCaml SDK

While for the end-user, it's not that important:

* [x] Can detect/use WSL SDKs
* [ ] Can detect/use Cygwin SDKs
* [ ] Can detect/use OCaml64 SDKs
* [ ] Can detect/use Linux SDKs
* [ ] Can add a "SimpleSDK" (non-opam) (Removed Code)
* [x] The SDK files are shown nicely in the Library

There is a bug I can't patch, so the user cannot edit anymore the OCaml manual/API URLs.

üìö We suggest the user to set the SDK if not set.

## Smart Elements

Currently, every element is considering itself as public.

* [ ] Fix this, detect MLI, none==PUBLIC, if MLI, inside==PUBLIC

# Supporting a new element

Adding support for a new element, e.g. making the element "smart" so that you can resolve its references, usages, etc. requires quite a few steps.

* ...
* Update the annotator
* Update the color settings page
* Update the structure view
* Update the presentation handler
* ...

# Other missing features

A few of the things that are missing:

* [ ] Warning/Error Annotations
* [ ] Surround With
* [ ] Quotes handler
* [ ] Paste processor
* [ ] Smart enter processor