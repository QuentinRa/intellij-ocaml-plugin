# README

**Goal**: implement the least feature to have a working plugin using the new parser. This is PoC to test if we can use JetBrains Grammar File.

The project is complex, so here are some notes for you.

* [ ] GitHub CI
* [ ] User Documentation

## Parser Rules

The plugin is based on a [parser generated by grammar kit](https://github.com/JetBrains/Grammar-Kit). The parser rules are, as much as possible, similar to the one [in the official documentation]( https://v2.ocaml.org/manual/lex.html).

* `OCaml.bnf`: the parser rules for ML and MLI (ML by default, uncomment out the two lines for MLI)
* `_OCamlLexer.flex`: to generate the symbols used by the parser

**Roadmap**

* [x] Add some pins
    * [ ] Add more pins
    * [ ] Verify pins
* [ ] Parser Errors are not handled
* [ ] Parser recovery is not handled
* [ ] Parser tests were not implemented
  * `exception Undefined = CamlinternalLazy.Undefined`
* [ ] Make it simple to compile both parsers

## Parsed Tree Integration

Once we were able to match the code to a syntax tree, we need to integrate "smart features".

#### From "syntax" to "logic"

In short, you can use these as reference when you need to highlight stuff differently based on what their type:

* `OCamlLetDeclaration` (declaration) and `OCamlLetBindingMixin` (implementation): refer to highlighter to see how it is used. For instance, functions are highlighted differently than normal variables
* `OCamlLetDeclaration` (declaration) and `OCamlValBindingMixin` (implementation): same as for Let
* ...

#### Anonymous

In OCaml, we can use `_` as a name identifier for an anonymous element. Such element should NOT be:

* Indexed
* Shown in the structure view
* Considered as having a name (name=null)

#### Deconstructions

Some variables may be introduced as a part of an object deconstruction.

#### Indexes

Before indexing, we need to create stubs for lightweight parsing.

* [x] Add Stubs For Variables
* [ ] Add Stubs For ...
* [x] Do not store anonymous variables
* [ ] Use stubs in structure view (What do you mean?)
* [ ] Supported nested variables (e.g. fix qualified path, etc.)

Indexes are closely related to references. We can search for elements after indexing them. They are used when resolving references.

* [x] Add indexes for variables
* [ ] Use an index of integers?

#### References

From a fully qualified path, we can find the declarations for:

* [x] Variables (Let)
* [x] Variable declarations (VAL)

From all others, e.g. nested variables, included variables, local variables:

* [ ] Determine how to handle that (compiler? manual?)

Additional problems

* [ ] The named element should be "x" and not "let x = ..."

## User Features

#### Highlighter

* [x] Add Lexer Highlighter
* [x] Add Annotator Highlighter
* [ ] ~~Highlight pattern variables~~ (e.g. in "match")

#### Spellchecker

* [x] Comments
* [x] Strings
* [x] Identifiers

#### Typing

* [x] Braces matching (hover the other)
* [ ] Quotes handler
* [ ] Paste processor
* [ ] Smart enter processor
* [x] Single Line Comments Handler (CTRL+/)
* [x] Multi Lines Comments Handler (CTRL+SHIFT+/)
* [ ] Comments: space not removed after uncommenting ("(* ")
* [ ] Other handlers

#### Smart Features

* [ ] Warning/Error Annotations
* [X] Structure View (ALT+7)
  * [x] Variables
  * [x] Handle Visibility (public/private)
  * [ ] Filters (nested variables?)
  * [ ] Add types?
  * [ ] Add function arguments?
* [ ] Surround With
* [x] Live Templates
  * [x] Basic implementation
  * [ ] Add scopes (no for in MLI?)
  * [x] Not available in comments
  * [x] Not available in other files
* [X] Line Markers
  * [X] Declaration
  * [x] Implementation
  * [x] Show a nice presentation
  * [x] Works with pattern variables (ex: "a,b,c")

#### Settings

* [X] Color Settings Page For Highlighter
* [x] Add Highlighter Annotator to Color Settings Page

## Dune

* [x] Highlight
* [x] Annotator Highlight
* [x] Structure View
* [x] Braces matching
* [x] Commenter
* [ ] Add references for paths/files
* [ ] Add folding for variables
* [ ] Live Templates